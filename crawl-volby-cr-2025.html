<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crawl ÄŒR 2025</title>
    
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: transparent;
            overflow: hidden;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            align-items: flex-end;
        }

        .dashboard-container {
            width: 100%;
            height: 165px;
            background: transparent;
            display: flex;
            flex-direction: column;
            position: fixed;
            bottom: 0;
            left: 0;
        }

        /* Header pro ÄŒR crawl */
        .cr-header {
            height: 50px;
            background: #e92929;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            padding: 12px 20px;
        }

        .cr-header-content {
            font-size: 24px;
            font-weight: 600;
            color: #fafafa;
        }

        .cr-header-separator {
            margin: 0 12px;
            color: #fafafa;
            font-weight: 400;
        }

        .cr-header-stats {
            font-size: 18px;
            font-weight: 500;
            color: #fafafa;
        }

        .cr-header-debug {
            margin-left: auto;
            font-size: 14px;
            color: #ffc0c0;
        }

        /* Kontejner pro parties ÄŒR crawl */
        .cr-parties-container {
            display: flex;
            height: 115px;
            align-items: center;
            position: relative;
            background: #f8f9fa;
            white-space: nowrap;
            padding: 0 20px;
            transform: translateX(100%);
        }

        @keyframes cr-scroll-left {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .cr-parties-container.animate {
            animation: cr-scroll-left 60s linear infinite;
        }

        /* Animace pro refresh dat po dokonÄenÃ­ */
        @keyframes cr-scroll-left-with-refresh {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .cr-parties-container.refresh {
            animation: cr-scroll-left-with-refresh 60s linear;
        }

        .cr-parties-container.updating {
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .cr-party-block {
            display: inline-flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 6px 16px;
            margin: 0;
            width: 220px;
            position: relative;
            background: white;
            border-left: 4px solid;
            border-right: 1px solid #e9ecef;
            text-align: left;
            height: 115px;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .cr-party-name {
            font-size: 16px;
            font-weight: 700;
            color: #212529;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            line-height: 1.1;
            margin-bottom: 8px;
            word-wrap: break-word;
        }

        .cr-party-percent {
            font-size: 22px;
            font-weight: 800;
            color: #212529;
            line-height: 1;
            text-align: right;
            align-self: flex-end;
        }

        .cr-divider {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 50px;
            flex-shrink: 0; /* DÅ¯leÅ¾itÃ© - zabraÅˆuje smrÅ¡tÄ›nÃ­ divideru */
        }

        .cr-divider-dot {
            width: 4px;
            height: 4px;
            background: #ced4da;
            border-radius: 50%;
            margin: 0 4px;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: 18px;
            color: #6c757d;
            font-weight: 500;
        }

        .updating {
            opacity: 0.7;
            transition: opacity 0.15s ease-in-out;
        }

        /* Debug panel */
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-width: 300px;
            border-radius: 5px;
            z-index: 9999;
        }

        .debug-panel.hidden {
            display: none;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .dashboard-container {
                height: 125px;
            }

            .cr-header {
                height: 35px;
                padding: 8px 15px;
            }

            .cr-header-content {
                font-size: 18px;
            }

            .cr-header-stats {
                font-size: 14px;
            }

            .cr-header-separator {
                margin: 0 8px;
            }

            .cr-parties-container {
                height: 90px;
            }

        .cr-party-block {
            width: 220px;
            height: 90px;
            padding: 6px 10px 4px 10px;
            border-left-width: 2px;
        }

            .cr-party-name {
                font-size: 12px;
                max-width: 80px;
            }

            .cr-party-mandates {
                font-size: 18px;
            }

            .cr-party-percent {
                font-size: 16px;
            }

            .cr-divider {
                width: 40px;
            }

            .loading {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="cr-crawl-container">
            <div class="cr-header">
                <div class="cr-header-content" id="crHeaderContent">ÄŒeskÃ¡ republika</div>
                <div class="cr-header-separator">|</div>
                <div class="cr-header-stats" id="crHeaderStats">seÄteno: 0,00%, ÃºÄast: 0,00%</div>
                <div class="cr-header-debug" id="crHeaderDebug"></div>
            </div>
            <div class="cr-parties-container" id="crPartiesContainer">
                <div class="loading">NaÄÃ­tÃ¡m celkovÃ© vÃ½sledky ÄŒR 2025...</div>
            </div>
        </div>
    </div>

    <!-- Debug panel -->
    <div class="debug-panel hidden" id="debugPanel">
        <div>Debug Info:</div>
        <div id="debugContent"></div>
    </div>

    <script>
        let crData = null;
        let isUpdating = false;
        
        // Debug mode - zapnout pro lokÃ¡lnÃ­ vÃ½voj nebo pÅ™idÃ¡nÃ­m ?debug=true do URL
        const urlParams = new URLSearchParams(window.location.search);
        const isDebugMode = urlParams.get('debug') === 'true' || 
                          window.location.hostname === 'localhost' || 
                          window.location.hostname === '127.0.0.1';
        
        const debugLog = function(...args) {
            if (isDebugMode) {
                console.log(...args);
                updateDebugPanel(...args);
            }
        };

        function updateDebugPanel(...args) {
            if (!isDebugMode) return;
            
            const panel = document.getElementById('debugPanel');
            const content = document.getElementById('debugContent');
            
            if (panel) {
                panel.classList.remove('hidden');
                const message = args.map(arg => 
                    typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
                ).join(' ');
                
                content.innerHTML = `${new Date().toLocaleTimeString()}: ${message}<br>${content.innerHTML}`.substring(0, 1000);
            }
        }

        // Oprava kÃ³dovÃ¡nÃ­ z API (Å¡patnÃ© UTF-8)
        function fixEncoding(text) {
            if (!text) return '';
            
            // MapovÃ¡nÃ­ nejÄastÄ›jÅ¡Ã­ch chyb v kÃ³dovÃ¡nÃ­
            const replacements = {
                'Ä‚Â­': 'Ã­', 'Ä‚Ä„': 'Ã¡', 'Ä‚Å ': 'Ã©', 'Ä‚Ë': 'Ã½',
                'Ä¹Å¾': 'Å¾', 'Ä¹ ': 'Å¡', 'Ã„': 'Ä', 'Ä¹': 'Å™',
                'Ã„': 'Ä', 'Ä¹Â¥': 'Å¥', 'Ä¹': 'Åˆ', 'Ä‚ÅŸ': 'Ãº', 'Ä¹Â¯': 'Å¯',
                'Ä‚': 'Ã', 'Ä‚': 'Ã', 'Ä‚': 'Ã‰', 'Ä‚': 'Ã',
                'Ä¹Ë': 'Å½', 'Ä¹': 'Å ', 'Ã„': 'ÄŒ', 'Ä¹': 'Å˜',
                'Ã„': 'Ä', 'Ä¹Â¤': 'Å¤', 'Ä¹': 'Å‡', 'Ä‚': 'Ãš', 'Ä¹Â®': 'Å®',
                'Ã„': 'Ä›', 'Ã„': 'Äš', 'Ä‚Å‚': 'Ã³', 'Ä‚': 'Ã“',
                'Ã¢': 'â€”', 'Ã¢Åš': 'â€¦', 'Ã¢': '"', 'Ã¢': '"'
            };
            
            let fixed = text;
            for (const [wrong, correct] of Object.entries(replacements)) {
                fixed = fixed.replace(new RegExp(wrong, 'g'), correct);
            }
            
            return fixed;
        }

        // EscapovÃ¡nÃ­ HTML pro bezpeÄnÃ© vloÅ¾enÃ­ nÃ¡zvÅ¯ stran
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            // NejdÅ™Ã­v opravit kÃ³dovÃ¡nÃ­, pak escapovat
            const fixed = fixEncoding(unsafe);
            return fixed
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // FormÃ¡tovÃ¡nÃ­ ÄÃ­sel pro Äeskou lokalizaci
        function formatNumber(num) {
            if (num === null || num === undefined) return "0";
            return new Intl.NumberFormat('cs-CZ').format(num);
        }

        // FormÃ¡tovÃ¡nÃ­ procent
        function formatPercent(num) {
            if (num === null || num === undefined || isNaN(num)) return "0.0";
            return parseFloat(num).toFixed(1);
        }

        // FormÃ¡tovÃ¡nÃ­ pro "pÅ™ed volbami" stav
        function formatPercentForDisplay(num) {
            if (num === null || num === undefined || isNaN(num)) return "0.0";
            return parseFloat(num).toFixed(1);
        }

        async function loadCrData() {
            debugLog('ğŸ”„ ZaÄÃ­nÃ¡m naÄÃ­tÃ¡nÃ­ dat za celou ÄŒR...');
            
            try {
                let response;
                let dataSource = 'unknown';
                
                // Pokus 1: PÅ™Ã­mÃ© naÄtenÃ­ z API
                try {
                    const apiUrl = 'https://api.elections.seznam.cz/parliament/2025/results/cr';
                    response = await fetch(apiUrl);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    dataSource = 'direct-api';
                    debugLog('âœ… PÅ™Ã­mÃ© naÄtenÃ­ z API ÃºspÄ›Å¡nÃ©');
                } catch (error) {
                    debugLog('âŒ PÅ™Ã­mÃ© naÄtenÃ­ selhalo:', error.message);
                    
                    // Pokus 2: CORS proxy
                    const corsProxies = [
                        'https://cors-anywhere.herokuapp.com/',
                        'https://api.allorigins.win/raw?url=',
                        'https://thingproxy.freeboard.io/fetch/'
                    ];
                    
                    let proxySuccess = false;
                    for (const proxy of corsProxies) {
                        try {
                            const proxyUrl = proxy + encodeURIComponent('https://api.elections.seznam.cz/parliament/2025/results/cr');
                            response = await fetch(proxyUrl);
                            if (response.ok) {
                                dataSource = `proxy-${proxy}`;
                                debugLog(`âœ… CORS proxy ÃºspÄ›Å¡nÃ©: ${proxy}`);
                                proxySuccess = true;
                                break;
                            }
                        } catch (proxyError) {
                            debugLog(`âŒ CORS proxy selhalo: ${proxy}`, proxyError.message);
                            continue;
                        }
                    }
                    
                    if (!proxySuccess) {
                        throw new Error('VÅ¡echny pokusy o naÄtenÃ­ dat selhaly');
                    }
                }
                
                const data = await response.json();
                debugLog('ğŸ“Š Raw data struktura:', Object.keys(data));
                debugLog(`ğŸ“Š Data source: ${dataSource}`);
                
                // Detekce problÃ©mÅ¯ s kÃ³dovÃ¡nÃ­m
                const sampleText = JSON.stringify(data).substring(0, 500);
                const needsFixing = sampleText.includes('Ä‚') || sampleText.includes('Ä¹') || sampleText.includes('Ã„');
                if (needsFixing) {
                    debugLog('âš ï¸ DetekovÃ¡no poÅ¡kozenÃ© UTF-8 kÃ³dovÃ¡nÃ­, aplikuji opravu...');
                } else {
                    debugLog('âœ… KÃ³dovÃ¡nÃ­ v poÅ™Ã¡dku, data jsou ÄitelnÃ¡');
                }
                
                // RÅ¯znÃ© moÅ¾nÃ© struktury API
                let allParties = [];
                
                // Pokus 1: _items (API 2025)
                
                // Pokus 1: _items (API 2025)
                if (data._items && Array.isArray(data._items)) {
                    allParties = data._items;
                    debugLog(`ğŸ“Š Nalezeno ${allParties.length} stran v _items`);
                }
                // Pokus 2: parties (starÅ¡Ã­ API)
                else if (data.parties && Array.isArray(data.parties)) {
                    allParties = data.parties;
                    debugLog(`ğŸ“Š Nalezeno ${allParties.length} stran v parties`);
                }
                // Pokus 3: results
                else if (data.results && Array.isArray(data.results)) {
                    allParties = data.results;
                    debugLog(`ğŸ“Š Nalezeno ${allParties.length} stran v results`);
                }
                // Pokus 4: data je pÅ™Ã­mo array
                else if (Array.isArray(data)) {
                    allParties = data;
                    debugLog(`ğŸ“Š Data jsou pÅ™Ã­mo array s ${allParties.length} stranami`);
                }
                
                debugLog(`ğŸ“Š Celkem nalezeno ${allParties.length} poloÅ¾ek pÅ™ed zpracovÃ¡nÃ­m`);
                
                // Vypsat prvnÃ­ 3 strany pro debug
                if (allParties.length > 0) {
                    debugLog('ğŸ“Š UkÃ¡zka prvnÃ­ch 3 stran (raw):', allParties.slice(0, 3));
                }
                
                // ZpracovÃ¡nÃ­ dat - NEZFILTROVAT, zobrazit vÅ¡e
                const processedParties = [];
                
                allParties.forEach((party, index) => {
                    // PouÅ¾Ã­t shortName8 pokud existuje, jinak shortName nebo name
                    let name = party.shortName8 || party.shortName || party.name || `Strana ${index + 1}`;
                    
                    // Debug kaÅ¾dÃ© strany
                    debugLog(`ğŸ“Š Strana ${index + 1}: shortName8="${party.shortName8}", name="${name}"`);
                    
                    // PÅ™eskoÄit pouze pokud je nÃ¡zev ÃºplnÄ› prÃ¡zdnÃ½
                    if (!name || name.trim().length === 0) {
                        debugLog(`âš ï¸ PÅ™eskakuji stranu ${index + 1} - prÃ¡zdnÃ½ nÃ¡zev`);
                        return;
                    }
                    
                    // Debug - pÅ™idat stranu do seznamu
                    debugLog(`âœ… PÅ™idÃ¡vÃ¡m stranu: "${name}"`);
                    
                    // Omezit dÃ©lku nÃ¡zvu na maximum 20 znakÅ¯
                    if (name.length > 20) {
                        name = name.substring(0, 17) + '...';
                    }
                    
                    // Opravit kÃ³dovÃ¡nÃ­ POUZE pokud je potÅ™eba
                    if (needsFixing) {
                        name = fixEncoding(name);
                    }
                    
                    // Odstranit problematickÃ© unicode znaky
                    name = name
                        .replace(/â€¦/g, '...')  // Nahradit unicode tÅ™i teÄky
                        .replace(/â€”/g, '-')    // Nahradit unicode pomlÄku
                        .replace(/"/g, '"')    // Nahradit unicode uvozovky
                        .replace(/"/g, '"')
                        .replace(/'/g, "'")
                        .replace(/'/g, "'")
                        .replace(/[\u2000-\u206F]/g, '')  // Odstranit speciÃ¡lnÃ­ formÃ¡tovacÃ­ znaky
                        .replace(/[\u2E00-\u2E7F]/g, '')  // Odstranit doplÅˆkovou interpunkci
                        .trim();
                    
                    // ZÃ­skat barvu z rÅ¯znÃ½ch moÅ¾nÃ½ch polÃ­
                    let color = party.vParty?.color || 
                               party.color || 
                               party.partyColor ||
                               party.colour ||
                               '#6c757d';
                    
                    // OÅ¡etÅ™it barvu - pÅ™idat # pokud chybÃ­
                    if (color && !color.startsWith('#')) {
                        color = '#' + color;
                    }
                    
                    // PÅ™eskoÄit Å¡edÃ© barvy (#bebebe) a pÅ™idÄ›lit nÃ¡hodnou
                    if (color === '#bebebe' || color === '#6c757d') {
                        // Generovat barvu na zÃ¡kladÄ› nÃ¡zvu strany pro konzistenci
                        const hash = name.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                        const hue = (hash * 137) % 360; // PseudonÃ¡hodnÃ© ale konzistentnÃ­
                        color = `hsl(${hue}, 65%, 50%)`;
                        debugLog(`ğŸ¨ Strana "${name}" mÃ¡ Å¡edou barvu, pÅ™idÄ›luji: ${color}`);
                    }
                    
                    const processedParty = {
                        shortName8: name,
                        color: color,
                        votes: party.votes || party.totalVotes || 0,
                        votesPercent: party.votesPercent || party.percent || party.percentage || 0,
                        numOfMandates: party.numOfMandates || party.mandates || party.seats || 0
                    };
                    
                    processedParties.push(processedParty);
                    
                    // Debug vÅ¡echny strany
                    debugLog(`ğŸ“Š Strana ${index + 1}/${allParties.length}: "${name}", barva: ${color}`);
                });
                
                // SeÅ™adit podle nÃ¡zvu (vÅ¡echny strany majÃ­ 0% - "pÅ™ed volbami")
                processedParties.sort((a, b) => {
                    return a.shortName8.localeCompare(b.shortName8);
                });
                
                crData = {
                    turnout: data.turnout || {},
                    parties: processedParties
                };
                
                debugLog(`âœ… ÄŒR data pÅ™ipravena: ${crData.parties.length} stran`);
                
                // Aktualizovat header s poÄtem stran
                const debugElement = document.getElementById('crHeaderDebug');
                if (debugElement) {
                    debugElement.textContent = `(${crData.parties.length} stran)`;
                }
                
                startCrCrawl();
                
            } catch (error) {
                debugLog('âŒ KritickÃ¡ chyba pÅ™i naÄÃ­tÃ¡nÃ­ dat:', error);
                
                // RozÅ¡Ã­Å™enÃ½ fallback - testovacÃ­ data
                crData = {
                    turnout: { voterTurnout: 0.0, precinctsFinishedPercent: 0.0 },
                    parties: generateFallbackParties()
                };
                
                debugLog(`âœ… Fallback data pÅ™ipravena: ${crData.parties.length} stran`);
                
                const debugElement = document.getElementById('crHeaderDebug');
                if (debugElement) {
                    debugElement.textContent = `(${crData.parties.length} stran - FALLBACK)`;
                }
                
                startCrCrawl();
            }
        }

        function generateFallbackParties() {
            // Generovat 26+ testovacÃ­ch stran se sprÃ¡vnÃ½mi ÄeskÃ½mi znaky
            const parties = [];
            const baseParties = [
                { name: "ANO", color: "#261060" },
                { name: "SPOLU", color: "#00EA29" },
                { name: "STAN", color: "#B90E5E" },
                { name: "PirÃ¡ti", color: "#6E6E6E" },
                { name: "SPD", color: "#C05F2F" },
                { name: "PÅ˜ÃSAHA", color: "#0240C6" },
                { name: "StaÄilo!", color: "#F90A0E" },
                { name: "KSÄŒM", color: "#DC143C" },
                { name: "AUTO", color: "#19A2E2" },
                { name: "ÄŒSSD", color: "#f9932e" },
                { name: "ÄŒR1", color: "#808080" },
                { name: "Levice", color: "#B22222" },
                { name: "Å vÃ½carskÃ¡ dem.", color: "#4169E1" },
                { name: "MZH", color: "#FFD700" },
                { name: "SMSka", color: "#00CED1" },
                { name: "BPS", color: "#98FB98" },
                { name: "Kruh", color: "#DDA0DD" },
                { name: "Volt", color: "#FF69B4" },
                { name: "Generace", color: "#20B2AA" },
                { name: "PB", color: "#F0E68C" },
                { name: "JaSaN", color: "#B0C4DE" },
                { name: "Koruna ÄŒeskÃ¡", color: "#DAA520" },
                { name: "HOP Hydra", color: "#CD5C5C" },
                { name: "RebelovÃ©", color: "#8B4513" },
                { name: "Voluntia", color: "#9370DB" },
                { name: "VÃZVA", color: "#3CB371" },
                { name: "Nevolte Urza.cz", color: "#FF6347" }
            ];
            
            return baseParties.map((party, index) => ({
                shortName8: party.name,
                color: party.color,
                votes: Math.floor(Math.random() * 100000),
                votesPercent: Math.random() * 10,
                numOfMandates: index < 5 ? Math.floor(Math.random() * 30) : 0
            }));
        }

        function startCrCrawl() {
            if (!crData) {
                debugLog('âš ï¸ Å½Ã¡dnÃ¡ data k zobrazenÃ­');
                return;
            }
            
            // Aktualizovat ÄŒR header
            const crHeaderStats = document.getElementById('crHeaderStats');
            const turnout = crData.turnout || {};
            const counted = turnout.precinctsFinishedPercent || 0;
            const voterTurnout = turnout.voterTurnout || 0;
            
            crHeaderStats.innerHTML = `seÄteno: ${formatPercent(counted)}%, ÃºÄast: ${formatPercent(voterTurnout)}%`;
            
            // Generovat ÄŒR crawl content
            generateCrCrawlContent();
        }

        function generateCrCrawlContent() {
            const container = document.getElementById('crPartiesContainer');
            
            if (!crData || !crData.parties || crData.parties.length === 0) {
                container.innerHTML = '<div class="loading">Å½Ã¡dnÃ¡ data pro ÄŒR</div>';
                debugLog('âš ï¸ Å½Ã¡dnÃ© strany k zobrazenÃ­');
                return;
            }
            
            let content = '';
            const partyCount = crData.parties.length;
            
            debugLog(`ğŸ¨ ZaÄÃ­nÃ¡m generovat HTML pro ${partyCount} stran`);
            debugLog('ğŸ“Š PrvnÃ­ 3 strany pro kontrolu:', crData.parties.slice(0, 3));
            
            // Smooth update - pÅ™idat updating class (jako v krajÃ­ch)
            container.classList.add('updating');
            
            setTimeout(() => {
                let content = '';
                
                // VytvoÅ™it obsah pouze jednou (ne opakovÃ¡nÃ­) - jako v krajÃ­ch
                crData.parties.forEach((party, index) => {
                    // ZobrazÃ­ celÃ½ nÃ¡zev - bloky se pÅ™izpÅ¯sobÃ­ (jako v krajÃ­ch)
                    const displayName = party.shortName8;
                    const percent = formatPercent(party.votesPercent);
                    const mandates = party.numOfMandates || 0;
                    
                    // BezpeÄnÃ© escapovÃ¡nÃ­ HTML znakÅ¯
                    const safeName = displayName
                        .replace(/&/g, "&amp;")
                        .replace(/</g, "&lt;")
                        .replace(/>/g, "&gt;")
                        .replace(/"/g, "&quot;")
                        .replace(/'/g, "&#039;");
                    
                    content += `
                        <div class="cr-party-block" style="border-left-color: ${party.color};">
                            <div class="cr-party-name">${safeName}</div>
                            <div class="cr-party-percent">${percent}%</div>
                        </div>
                    `;
                    
                    // Debug kaÅ¾dÃ© 10. strany
                    if (index % 10 === 0) {
                        debugLog(`ğŸ“¦ Blok ${index}: "${displayName}"`);
                    }
                });
                
                // PÅ™idat VIDITELNÃ sentinel blok na konec (jako v krajÃ­ch)
                content += `
                    <div id="cr-crawl-sentinel" class="cr-party-block" style="
                        width: 160px !important;
                        min-width: 160px !important;
                        background: red !important;
                        border-left-color: red !important;
                    ">
                        <div class="cr-party-name">SENTINEL</div>
                        <div class="cr-party-percent">MARKER</div>
                    </div>
                `;
                
                container.innerHTML = content;
                container.classList.remove('updating');
                
                // PoÄet vygenerovanÃ½ch blokÅ¯
                const blockCount = container.querySelectorAll('.cr-party-block').length;
                debugLog(`âœ… VygenerovÃ¡no ${blockCount} blokÅ¯ stran (${partyCount} + 1 sentinel)`);
                debugLog(`âœ… Celkem ${partyCount} stran + sentinel (jako v krajÃ­ch)`);
                
                // Kontrola, zda se vÅ¡echny bloky sprÃ¡vnÄ› vykreslily
                if (blockCount !== partyCount + 1) {
                    debugLog(`âš ï¸ PROBLÃ‰M: OÄekÃ¡vÃ¡no ${partyCount + 1} blokÅ¯, ale vykresleno pouze ${blockCount}!`);
                    debugLog('ğŸ” MoÅ¾nÃ¡ nÄ›kterÃ¡ strana mÃ¡ problematickÃ½ nÃ¡zev kterÃ½ rozbÃ­jÃ­ HTML');
                    
                    // NajÃ­t problematickÃ© strany
                    crData.parties.forEach((party, index) => {
                        if (party.shortName8 && (party.shortName8.includes('<') || 
                            party.shortName8.includes('>') || 
                            party.shortName8.includes('"') ||
                            party.shortName8.includes("'") ||
                            party.shortName8.includes('/') ||
                            party.shortName8.includes('\\'))) {
                            debugLog(`âš ï¸ Strana ${index} mÃ¡ problematickÃ© znaky: "${party.shortName8}"`);
                        }
                    });
                }
                
                // Spustit animaci po naÄtenÃ­ obsahu (jako v krajÃ­ch)
                startCrCrawlAnimation();
                
            }, 150);
        }

        function startCrCrawlAnimation() {
            const container = document.getElementById('crPartiesContainer');
            
            // VypoÄÃ­tat Å¡Ã­Å™ky
            const viewportWidth = window.innerWidth;
            const contentWidth = container.scrollWidth;
            
            debugLog(`ğŸ¬ Start animace - viewport: ${viewportWidth}px, content: ${contentWidth}px`);
            debugLog(`ğŸ¬ PoÄet blokÅ¯ v kontejneru: ${container.querySelectorAll('.cr-party-block').length}`);
            
            // VypoÄÃ­tat sprÃ¡vnÃ½ koneÄnÃ½ translateX tak, aby poslednÃ­ prvek ÃºplnÄ› zmizel vlevo
            const finalTranslatePercent = -100 - (contentWidth / viewportWidth * 100);
            
            // VypoÄÃ­tat dobu animace (rychlost: 80px za sekundu)
            const totalDistance = viewportWidth + contentWidth;
            const animationDuration = Math.max(totalDistance / 80, 15);
            
            debugLog(`ğŸ¬ Animace: ${animationDuration}s, konec: ${finalTranslatePercent}%`);
            
            // VytvoÅ™it dynamickÃ© CSS keyframe
            const keyframeName = 'cr-scroll-left-' + Date.now();
            const keyframeCSS = `
                @keyframes ${keyframeName} {
                    0% { transform: translateX(100%); }
                    100% { transform: translateX(${finalTranslatePercent}%); }
                }
            `;
            
            // PÅ™idat CSS do head
            const style = document.createElement('style');
            style.textContent = keyframeCSS;
            document.head.appendChild(style);
            
            // Spustit animaci
            container.style.animation = `${keyframeName} ${animationDuration}s linear`;
            
            debugLog(`ğŸ¬ Animace spuÅ¡tÄ›na: ${keyframeName} ${animationDuration}s linear`);
            
            // Po dokonÄenÃ­ animace refreshovat data
            setTimeout(() => {
                debugLog('ğŸ”„ Animace dokonÄena - refresh dat');
                loadCrData();
            }, animationDuration * 1000);
        }

        // Inicializace pÅ™i naÄtenÃ­ strÃ¡nky
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('ğŸš€ Aplikace spuÅ¡tÄ›na');
            loadCrData();
        });

        // Refresh dat se spouÅ¡tÃ­ automaticky po dokonÄenÃ­ kaÅ¾dÃ© animace

        // KlÃ¡vesovÃ¡ zkratka pro debug (Ctrl+D)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                const panel = document.getElementById('debugPanel');
                if (panel) {
                    panel.classList.toggle('hidden');
                }
            }
        });
    </script>
</body>
</html>